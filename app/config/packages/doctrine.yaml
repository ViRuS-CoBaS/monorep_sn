doctrine:
    dbal:
        default_connection: read_model_connection  # –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        connections:
            # 1. WRITE CONNECTION (–î–ª—è Event Store)
            event_store_connection:
                url: '%env(resolve:DATABASE_URL_EVENT_STORE)%'
                server_version: '16'  # –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–¥–µ—Å—å, –µ—Å–ª–∏ –Ω–µ –≤ URL; –≤ –≤–∞—à–µ–º .env —É–∂–µ ?serverVersion=16
                profiling_collect_backtrace: '%kernel.debug%'
                use_savepoints: true
                driver: 'pdo_pgsql'
                charset: 'utf8'
                # üí° –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
                # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Write-heavy –Ω–∞–≥—Ä—É–∑–∫–∏:
                options:
                    # –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤, –µ—Å–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø–∏—Å–∏ –≤—ã—Å–æ–∫–∞
                    connect_timeout: 10
                    # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ/—É–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ (DBAL)
                    driver_options:
                        1000: false # –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

        # 2. READ CONNECTION (–î–ª—è –ü—Ä–æ–µ–∫—Ü–∏–π)
            read_model_connection: # –í—Ç–æ—Ä–∏—á–Ω–∞—è –ë–î
                url: '%env(resolve:DATABASE_URL_READ_MODEL)%'
                server_version: '16'
                profiling_collect_backtrace: '%kernel.debug%'
                use_savepoints: true
                driver: 'pdo_pgsql'
                charset: 'utf8'
                # üí° –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
                options:
                    # –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–µ—à–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤
                    # (—Ö–æ—Ç—è –ª—É—á—à–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ Redis/Memcache)
                    connect_timeout: 5
                    # –î–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ Read Model –æ–±—ã—á–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–µ–Ω—å—à–∏–π —Ç–∞–π–º–∞—É—Ç
#            # 3. CCS CONNECTION (–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –¶–ö–°)
#            ccs_connection:
#                url: '%env(resolve:DATABASE_URL_CCS)%'
#                server_version: '16'
    orm:
        auto_generate_proxy_classes: true  # –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏-–∫–ª–∞—Å—Å–æ–≤ (dev: true; prod: false)
        enable_lazy_ghost_objects: true    # –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ (—É–ª—É—á—à–∞–µ—Ç perf)
        default_entity_manager: read_manager
        # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ORM (–∑–¥–µ—Å—å, –∞ –Ω–µ –ø–æ–¥ entity_managers)
        entity_managers:
            # 1. READ MANAGER (–î–ª—è –ü—Ä–æ–µ–∫—Ü–∏–π)
            read_manager:
                connection: read_model_connection
#                mappings:
#                    # –ó–¥–µ—Å—å —Ç–æ–ª—å–∫–æ Read Models (–Ω–∞–ø—Ä–∏–º–µ—Ä, IssuerReadModel)
#                    App\Domain\ClientContext\ReadModel\:
#                        is_bundle: false
#                        type: attribute
#                        dir: '%kernel.project_dir%/src/Domain/ClientContext/ReadModel'
#                        prefix: 'App\Domain\ClientContext\ReadModel'
#                        alias: ReadModel
            # 2. CCS READ MANAGER (–î–ª—è –¶–ö–° (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –Ω–∏–∫–∞–∫–æ–π –∑–∞–ø–∏—Å–∏))
#            ccs_manager:
#                connection: ccs_connection
##                mappings:
#                    # –ó–¥–µ—Å—å —Ç–æ–ª—å–∫–æ Read Models (–Ω–∞–ø—Ä–∏–º–µ—Ä, IssuerReadModel)
#                    App\Domain\ClientContext\ReadModel\:
#                        is_bundle: false
#                        type: attribute
#                        dir: '%kernel.project_dir%/src/Domain/ClientContext/ReadModel'
#                        prefix: 'App\Domain\ClientContext\ReadModel'
#                        alias: ReadModel

when@test:
    doctrine:
        dbal:
            # "TEST_TOKEN" is typically set by ParaTest
            dbname_suffix: '_test%env(default::TEST_TOKEN)%'

when@prod:
    doctrine:
        orm:
            auto_generate_proxy_classes: false
            proxy_dir: '%kernel.build_dir%/doctrine/orm/Proxies'
            query_cache_driver:
                type: pool
                pool: doctrine.system_cache_pool
            result_cache_driver:
                type: pool
                pool: doctrine.result_cache_pool

    framework:
        cache:
            pools:
                doctrine.result_cache_pool:
                    adapter: cache.app
                doctrine.system_cache_pool:
                    adapter: cache.system
